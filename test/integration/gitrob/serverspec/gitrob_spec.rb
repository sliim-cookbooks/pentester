# -*- coding: utf-8 -*-

require 'spec_helper'

describe service 'postgresql' do
  it { should be_enabled }
  it { should be_running }
end

describe file '/root/.gitrobrc' do
  it { should be_file }
  its(:content) { should match(%r{sql_connection_uri: postgres://gitrob_user:gitrob_pass@127.0.0.1:5432/gitrob_db}) }

  its(:content) { should_not match(/this-token-should-be-replaced-with-databag/) }
end

describe file '/root/.gitrobsignatures' do
  it { should be_file }
  [/"part"\:"filename"/,
   /"type":"match"/,
   /"pattern":"c99.php"/,
   /"caption":"Oh F\*ck\*\* backdoor\!"/,
   /"description":null/].each do |m|
    its(:content) { should match(m) }
  end
end
