# -*- coding: utf-8 -*-

require_relative 'spec_helper'

describe 'pentester::w3af_profiles' do
  let(:subject) do
    ChefSpec::SoloRunner.new do |node|
      node.override['pentester']['w3af']['profiles_path'] = '/opt/w3af/profiles'
      node.override['pentester']['w3af']['profiles'] = {
        test: {
          section: {
            key: 'value'
          }
        }
      }
    end.converge(described_recipe)
  end

  it 'creates template[/opt/w3af/profiles/test.pw3af]' do
    config_file = '/opt/w3af/profiles/test.pw3af'
    expect(subject).to create_template(config_file)
      .with(owner: 'root',
            group: 'root',
            source: 'w3af/profile.pw3af.erb')

    [/^\[section\]$/, /^key = value$/].each do |m|
      expect(subject).to render_file(config_file).with_content(m)
    end
  end
end
