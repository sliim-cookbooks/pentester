require_relative 'spec_helper'

describe 'pentester::peda' do
  let(:subject) do
    ChefSpec::SoloRunner.new.converge(described_recipe)
  end

  it 'syncs git[/root/.peda]' do
    expect(subject).to sync_git('/root/.peda')
      .with(user: 'root', group: 'root',
            repository: 'https://github.com/longld/peda', reference: 'master')
  end

  it 'should not creates file[/root/.gdbinit]' do
    expect(subject).to_not create_file('/root/.gdbinit')
  end

  context 'with gdbinit' do
    let(:subject) do
      ChefSpec::SoloRunner.new do |node|
        node.override['pentester']['peda']['gdbinit'] = true
      end.converge(described_recipe)
    end

    it 'creates file[/root/.gdbinit]' do
      expect(subject).to create_file('/root/.gdbinit')
        .with(owner: 'root', group: 'root', content: 'source ~/.peda/peda.py')
    end
  end
end
