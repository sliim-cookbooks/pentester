# -*- coding: utf-8 -*-

require_relative 'spec_helper'

describe 'pentester::autopwn' do
  subject { ChefSpec::SoloRunner.new.converge(described_recipe) }

  it 'includes recipe[git]' do
    expect(subject).to include_recipe('git')
  end

  it 'sync git[/opt/autopwn]' do
    expect(subject).to sync_git('/opt/autopwn')
      .with(repository: 'https://github.com/nccgroup/autopwn',
            reference: 'master')
  end

  it 'runs execute[install-dependencies]' do
    expect(subject).to run_execute('install-dependencies')
      .with(cwd: '/opt/autopwn',
            command: 'pip install .')
  end

  it 'creates directory[/opt/autopwn/targets]' do
    expect(subject).to create_directory('/opt/autopwn/targets')
  end

  it 'creates file[/opt/autopwn/targets/example]' do
    expect(subject).to create_template('/opt/autopwn/targets/example')
      .with(source: 'autopwn/target.erb')
  end
end
