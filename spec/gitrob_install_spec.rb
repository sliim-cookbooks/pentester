# -*- coding: utf-8 -*-

require_relative 'spec_helper'

describe 'pentester::gitrob_install' do
  let(:subject) do
    ChefSpec::SoloRunner
      .new(platform: 'debian',
           version: '9.0') do |node|
    end.converge(described_recipe)
  end

  it 'installs gem_package[gitrob]' do
    expect(subject).to install_gem_package('gitrob')
  end

  context 'on debian 7.x' do
    let(:subject) do
      ChefSpec::SoloRunner.new(platform: 'debian',
                               version: '7.11').converge(described_recipe)
    end

    ['ruby1.9.3',
     'ruby-dev',
     'postgresql-server-dev-9.1'].each do |pkg|
      it "installs package[#{pkg}]" do
        expect(subject).to install_package(pkg)
      end
    end
  end

  context 'on debian 8.x' do
    let(:subject) do
      ChefSpec::SoloRunner.new(platform: 'debian',
                               version: '8.8').converge(described_recipe)
    end

    ['ruby2.1',
     'ruby2.1-dev',
     'postgresql-server-dev-9.4'].each do |pkg|
      it "installs package[#{pkg}]" do
        expect(subject).to install_package(pkg)
      end
    end
  end
end
