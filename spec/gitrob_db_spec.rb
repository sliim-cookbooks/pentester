require_relative 'spec_helper'

describe 'pentester::gitrob_db' do
  let(:subject) do
    ChefSpec::SoloRunner.new do |node|
      node.override['postgresql']['password']['postgres'] = 'postgres'
      node.override['postgresql']['config'] = {}
    end.converge(described_recipe)
  end

  before do
    stub_command('ls /recovery.conf').and_return(true)
  end

  it 'includes recipe[database::postgresql]' do
    expect(subject).to include_recipe('database::postgresql')
  end

  it 'creates postgresql_database_user[gitrob]' do
    expect(subject).to create_postgresql_database_user('gitrob')
      .with(password: 'gitrob')
  end

  it 'creates postgresql_database[gitrob]' do
    expect(subject).to create_postgresql_database('gitrob')
  end
end
