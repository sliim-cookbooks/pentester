# -*- coding: utf-8 -*-

require_relative 'spec_helper'

describe 'pentester::msf_db' do
  let(:subject) do
    ChefSpec::SoloRunner.new(platform: 'debian',
                             version: '9.0') do |node|
      node.override['postgresql']['password']['postgres'] = 'postgres'
      node.override['postgresql']['config'] = {}
    end.converge(described_recipe)
  end

  before do
    stub_command('ls /recovery.conf').and_return(true)
  end

  it 'includes recipe[database::postgresql]' do
    expect(subject).to include_recipe('database::postgresql')
  end

  it 'creates postgresql_database_user[msf]' do
    expect(subject).to create_postgresql_database_user('msf')
      .with(password: 'msf')
  end

  it 'creates postgresql_database[msf]' do
    expect(subject).to create_postgresql_database('msf')
  end
end
