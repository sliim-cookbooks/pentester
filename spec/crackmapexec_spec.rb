require_relative 'spec_helper'

describe 'pentester::crackmapexec' do
  let(:subject) do
    ChefSpec::SoloRunner.new.converge(described_recipe)
  end

  it 'syncs git[/opt/crackmapexec]' do
    expect(subject).to sync_git('/opt/crackmapexec')
      .with(repository: 'https://github.com/byt3bl33d3r/CrackMapExec',
            reference: 'master',
            enable_submodules: true)
  end

  it 'installs spython_runtime[2]' do
    expect(subject).to install_spython_runtime('2')
  end

  it 'will creates spython_venv[crackmapexec]' do
    expect(subject).to nothing_spython_venv('crackmapexec')
      .with(path: '/opt/crackmapexec/venv')
  end

  it 'will runs spython_exec[install-crackmapexec]' do
    expect(subject).to nothing_spython_exec('install-crackmapexec')
      .with(command: 'setup.py install',
            cwd: '/opt/crackmapexec')
  end
end
