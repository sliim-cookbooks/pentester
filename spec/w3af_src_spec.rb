require_relative 'spec_helper'

describe 'pentester::w3af_src' do
  let(:subject) do
    ChefSpec::SoloRunner.new.converge(described_recipe)
  end

  %w(libxml2-dev libxslt1-dev python-dev).each do |p|
    it "installs package[#{p}]" do
      expect(subject).to install_package(p)
    end
  end

  it 'syncs git[/opt/w3af]' do
    expect(subject).to sync_git('/opt/w3af')
      .with(repository: 'https://github.com/andresriancho/w3af.git',
            reference: 'master')
  end

  it 'installs spython_runtime[2]' do
    expect(subject).to install_spython_runtime('2')
  end

  ['pyClamd', 'pybloomfiltermmap', 'pyOpenSSL', 'pyasn1', 'lxml',
   'vulndb', 'psutil', 'mitmproxy', 'ruamel.ordereddict', 'Flask',
   'PyGithub', 'GitPython', 'esmre', 'phply', 'nltk', 'chardet',
   'tblib', 'pdfminer', 'futures', 'ndg-httpsclient', 'guess-language',
   'cluster', 'msgpack-python', 'python-ntlm', 'halberd', 'darts.util.lru',
   'Jinja2', 'scapy-real', 'markdown', 'PyYAML'].each do |p|
    it "installs python_package[#{p}]" do
      expect(subject).to install_spython_package(p)
    end
  end
end
