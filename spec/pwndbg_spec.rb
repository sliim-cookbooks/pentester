# -*- coding: utf-8 -*-

require_relative 'spec_helper'

describe 'pentester::pwndbg' do
  let(:subject) do
    ChefSpec::SoloRunner.new do |node|
      node.override['pentester']['pwndbg']['run_installer'] = true
    end.converge(described_recipe)
  end

  it 'installs package[gdb]' do
    expect(subject).to install_package('gdb')
  end

  it 'syncs git[/opt/pwndbg]' do
    expect(subject).to sync_git('/opt/pwndbg')
      .with(repository: 'https://github.com/pwndbg/pwndbg',
            reference: 'dev')
  end

  it 'runs execute[./setup.sh]' do
    expect(subject).to run_execute('./setup.sh')
      .with(cwd: '/opt/pwndbg',
            user: 'root',
            group: 'root')
  end
end
